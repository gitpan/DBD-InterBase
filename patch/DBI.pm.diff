--- DBI.pm.asli	Tue Aug 29 23:32:04 2000
+++ DBI.pm	Wed Aug 30 01:06:58 2000
@@ -1113,20 +1113,15 @@
 	    }
 	}
 	elsif ($mode eq 'HASH') {
-	    my @o_keys = keys %$slice;
-	    if (@o_keys) {
+		my @o_keys = %$slice ? map { lc($_) } keys %$slice
+			: map { lc($_) } @{ $sth->FETCH('NAME') };
 		my %i_names = map {  (lc($_)=>$_) } @{ $sth->FETCH('NAME') };
-		my @i_keys  = map { $i_names{lc($_)} } @o_keys;
+		my @i_keys  = map { $i_names{$_} } @o_keys;
 		while ($row = $sth->fetchrow_hashref) {
 		    my %hash;
 		    @hash{@o_keys} = @{$row}{@i_keys};
 		    push @rows, \%hash;
 		}
-	    }
-	    else {
-		# XXX assumes new ref each fetchhash
-		push @rows, $row while ($row = $sth->fetchrow_hashref);
-	    }
 	}
 	else { Carp::croak("fetchall_arrayref($mode) invalid") }
 	return \@rows;
